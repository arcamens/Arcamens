{% load i18n %}

<button type="button" onclick="$('#eventsBell').css('color', 'white');" class="navbar-toggle e-get" 
data-show="{% url 'timeline_app:list-events' %}" data-toggle="collapse"
data-callback="$('#modal').modal('toggle');" 
data-shell="#modalContent"
href="#"> <span id="eventsBell" style="color:white;">
<span class="glyphicon glyphicon-bell"></span>  </span></button>

<button type="button" class="e-get navbar-toggle" style="color:white;"
data-shell="#main-view" data-toggle="collapse"
data-show="{% url 'timeline_app:list-timelines' %}">
<span class="glyphicon glyphicon-home"></span> </button>


<div class="collapse navbar-collapse" id="myNavbar">
<ul class="nav navbar-nav">

<li class="hidden-xs"><a onclick="$('#eventsBell').css('color', 'white');" class="e-get" 
data-show="{% url 'timeline_app:list-events' %}" 
data-callback="$('#modal').modal('toggle');" 
data-shell="#modalContent"
href="#"> <span id="eventsBell" style="color:white;">
<span class="glyphicon glyphicon-bell"></span> {% trans "Events" %} </span></a></li>

<li><a class="e-get" 
data-shell="#modalContent" data-callback="$('#modal').modal('show');"
data-show="{% url 'core_app:list-users' organization.id %}" href="#">
<span class="glyphicon glyphicon-user"></span>  {% trans "Members" %}</a></li>

<li>
<a href="#" 
class="e-get" data-shell="#modalContent" 
data-show="{% url 'core_app:update-organization' organization.id %}" 
data-toggle="modal" data-target="#modal">
<span class="glyphicon glyphicon-cog"></span> Settings
</a>
</li>

</ul>


{% include "core_app/navbar-context-dropdown.html" %}


<script>
function alertOpusEvent() {
    var audio = new Audio('/static/event-alert.mp3');
    audio.play();

    $('#eventsBell').css('color', 'orange');
}

var wsbroker = '127.0.0.1';  // mqtt websocket enabled broker
var wsport = 15675; // port for above
var client = new Paho.MQTT.Client(wsbroker, wsport, "/ws",
        "myclientid_" + parseInt(Math.random() * 100, 10));

// set callback handlers
client.onConnectionLost = onConnectionLost;
client.onMessageArrived = onMessageArrived;

// connect the client
client.connect({onSuccess:onConnect});

function onConnect() {
  console.log("onConnect");
  client.subscribe("{{user.id}}");
  // message = new Paho.MQTT.Message("Connected from browser!");
  // message.destinationName = "beta";
  // client.send(message);
}

function onConnectionLost(responseObject) {
  if (responseObject.errorCode !== 0) {
    console.log("onConnectionLost:"+responseObject.errorMessage);
  }
}

function onMessageArrived(message) {
  console.log("onMessageArrived:"+message.payloadString);
    alertOpusEvent();
}
</script>





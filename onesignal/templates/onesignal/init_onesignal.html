<link rel="manifest" href="/manifest.json" />
<script src="https://cdn.onesignal.com/sdks/OneSignalSDK.js" async=""></script>
<script>
  var OneSignal = window.OneSignal || [];
  OneSignal.push(function() {
    OneSignal.init({
      appId: "{{ONE_SIGNAL_APPID}}",
    });
  });

  OneSignal.push(function() {
     OneSignal.on('subscriptionChange', function (isSubscribed) {
     console.log("The user's subscription state is now:",isSubscribed);

     OneSignal.push(function() {
          OneSignal.sendTag("email", "{{device_email}}");
     });

     OneSignal.getUserId(function(onesignal_id) {
          $.get({ 
          url: "{% url 'onesignal:update-uuid' %}",
          data: {
          onesignal_id : onesignal_id,
          device_id: {{device_id}},
          }},
          
          function(data) {
              console.log("Updated onesignal_id!");
          });
          
          console.log("OneSignal User ID:", onesignal_id);
      });
   });
 });

</script>


